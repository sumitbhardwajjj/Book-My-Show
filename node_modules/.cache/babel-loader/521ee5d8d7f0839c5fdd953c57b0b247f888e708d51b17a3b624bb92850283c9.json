{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/91983/Documents/BookMySchool/book-my-show/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/91983/Documents/BookMySchool/book-my-show/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/91983/Documents/BookMySchool/book-my-show/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import BsContext from\"./BsContext\";import{jsx as _jsx}from\"react/jsx-runtime\";var BsState=function BsState(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),time=_useState2[0],changeTime=_useState2[1];// time slot which the user selects.\nvar _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),movie=_useState4[0],changeMovie=_useState4[1];// Movie which the user selects.\nvar _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),lastBookingDatas=_useState6[0],setLastBookingData=_useState6[1];// Last movie booking details.\nvar _useState7=useState({A1:0,A2:0,A3:0,A4:0,D1:0,D2:0}),_useState8=_slicedToArray(_useState7,2),noOfSeat=_useState8[0],changeNoOfSeats=_useState8[1];// No of seats which the user selects.\n// handling post request to save booking details on the backend\nvar handlePostBooking=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"https://bookmyshow-backend-main.onrender.com/api/booking\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({movie:movie,slot:time,seats:noOfSeat})});case 3:res=_context.sent;_context.next=6;return res.json();case 6:data=_context.sent;if(res.status===200){//reset the state on success\nchangeTime(\"\");changeMovie(\"\");changeNoOfSeats({A1:0,A2:0,A3:0,A4:0,D1:0,D2:0});setLastBookingData(data.data);//clearing the local storage when booking is successfull\nwindow.localStorage.clear();}_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.log(\"error\",_context.t0);return _context.abrupt(\"return\",false);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function handlePostBooking(){return _ref.apply(this,arguments);};}();useEffect(function(){//getting movies, slot and seats from localstorage and updating state (useful when page refreshes)\nvar movie=window.localStorage.getItem(\"movie\");var slot=window.localStorage.getItem(\"slot\");var seats=JSON.parse(window.localStorage.getItem(\"seats\"));if(movie||slot||seats){changeMovie(movie);changeTime(slot);changeNoOfSeats(seats);}},[]);return/*#__PURE__*/ (// providing all the required data to app\n_jsx(BsContext.Provider,{value:{handlePostBooking:handlePostBooking,movie:movie,changeMovie:changeMovie,time:time,changeTime:changeTime,noOfSeat:noOfSeat,changeNoOfSeats:changeNoOfSeats,lastBookingDatas:lastBookingDatas},children:props.children}));};export default BsState;","map":{"version":3,"names":["React","useState","useEffect","BsContext","BsState","props","time","changeTime","movie","changeMovie","lastBookingDatas","setLastBookingData","A1","A2","A3","A4","D1","D2","noOfSeat","changeNoOfSeats","handlePostBooking","fetch","method","headers","body","JSON","stringify","slot","seats","res","json","data","status","window","localStorage","clear","console","log","getItem","parse","children"],"sources":["C:/Users/91983/Documents/BookMySchool/book-my-show/src/Context/BsState.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport BsContext from \"./BsContext\";\r\n\r\nconst BsState = (props) => {\r\n  const [time, changeTime] = useState(\"\");                // time slot which the user selects.\r\n  const [movie, changeMovie] = useState(\"\");              // Movie which the user selects.\r\n  const [lastBookingDatas, setLastBookingData] = useState(null);  // Last movie booking details.\r\n  const [noOfSeat, changeNoOfSeats] = useState({\r\n    A1: 0,\r\n    A2: 0,\r\n    A3: 0,\r\n    A4: 0,\r\n    D1: 0,\r\n    D2: 0,\r\n  });  // No of seats which the user selects.\r\n\r\n  // handling post request to save booking details on the backend\r\n  const handlePostBooking = async () => {\r\n    // Sending api request to backend with user selected movie, slot and seats to book movie.\r\n    try {\r\n        \r\n        const res = await fetch(\r\n          `https://bookmyshow-backend-main.onrender.com/api/booking`,\r\n          {\r\n            method: \"POST\",\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({ movie: movie, slot: time, seats: noOfSeat }),\r\n          }\r\n        );\r\n        const data = await res.json();\r\n        if (res.status === 200) {\r\n          //reset the state on success\r\n          changeTime(\"\");\r\n          changeMovie(\"\");\r\n          changeNoOfSeats({\r\n            A1: 0,\r\n            A2: 0,\r\n            A3: 0,\r\n            A4: 0,\r\n            D1: 0,\r\n            D2: 0,\r\n          });\r\n          setLastBookingData(data.data);\r\n          //clearing the local storage when booking is successfull\r\n          window.localStorage.clear();\r\n        }\r\n        \r\n    } catch (error) {\r\n        console.log(\"error\", error);\r\n        return false\r\n    }\r\n    //showing message from backend on popup to user whether success or error\r\n  };\r\n\r\n  useEffect(() => {\r\n    //getting movies, slot and seats from localstorage and updating state (useful when page refreshes)\r\n    const movie = window.localStorage.getItem(\"movie\");\r\n    const slot = window.localStorage.getItem(\"slot\");\r\n    const seats = JSON.parse(window.localStorage.getItem(\"seats\"));\r\n\r\n    if(movie || slot || seats){\r\n      changeMovie(movie);\r\n      changeTime(slot);\r\n      changeNoOfSeats(seats);\r\n    }\r\n\r\n  }, []);\r\n\r\n  return (\r\n    // providing all the required data to app\r\n    <BsContext.Provider \r\n      value={{\r\n        handlePostBooking,\r\n        movie,\r\n        changeMovie,\r\n        time,\r\n        changeTime,\r\n        noOfSeat,\r\n        changeNoOfSeats,\r\n        lastBookingDatas,\r\n      }}>\r\n      {props.children}\r\n    </BsContext.Provider>\r\n  );\r\n};\r\n\r\nexport default BsState;\r\n"],"mappings":"waAAA,MAAOA,MAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAOC,UAAS,KAAM,aAAa,CAAC,2CAEpC,GAAMC,QAAO,CAAG,QAAVA,QAAO,CAAIC,KAAK,CAAK,CACzB,cAA2BJ,QAAQ,CAAC,EAAE,CAAC,wCAAhCK,IAAI,eAAEC,UAAU,eAAiC;AACxD,eAA6BN,QAAQ,CAAC,EAAE,CAAC,yCAAlCO,KAAK,eAAEC,WAAW,eAA+B;AACxD,eAA+CR,QAAQ,CAAC,IAAI,CAAC,yCAAtDS,gBAAgB,eAAEC,kBAAkB,eAAqB;AAChE,eAAoCV,QAAQ,CAAC,CAC3CW,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CACN,CAAC,CAAC,yCAPKC,QAAQ,eAAEC,eAAe,eAO3B;AAEL;AACA,GAAMC,kBAAiB,4FAAG,wLAIFC,MAAK,4DAErB,CACEC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAElB,KAAK,CAAEA,KAAK,CAAEmB,IAAI,CAAErB,IAAI,CAAEsB,KAAK,CAAEV,QAAS,CAAC,CACpE,CAAC,CACF,QATKW,GAAG,qCAUUA,IAAG,CAACC,IAAI,EAAE,QAAvBC,IAAI,eACV,GAAIF,GAAG,CAACG,MAAM,GAAK,GAAG,CAAE,CACtB;AACAzB,UAAU,CAAC,EAAE,CAAC,CACdE,WAAW,CAAC,EAAE,CAAC,CACfU,eAAe,CAAC,CACdP,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CAAC,CACLC,EAAE,CAAE,CACN,CAAC,CAAC,CACFN,kBAAkB,CAACoB,IAAI,CAACA,IAAI,CAAC,CAC7B;AACAE,MAAM,CAACC,YAAY,CAACC,KAAK,EAAE,CAC7B,CAAC,iFAGDC,OAAO,CAACC,GAAG,CAAC,OAAO,aAAQ,CAAC,gCACrB,KAAK,uEAGjB,kBArCKjB,kBAAiB,0CAqCtB,CAEDlB,SAAS,CAAC,UAAM,CACd;AACA,GAAMM,MAAK,CAAGyB,MAAM,CAACC,YAAY,CAACI,OAAO,CAAC,OAAO,CAAC,CAClD,GAAMX,KAAI,CAAGM,MAAM,CAACC,YAAY,CAACI,OAAO,CAAC,MAAM,CAAC,CAChD,GAAMV,MAAK,CAAGH,IAAI,CAACc,KAAK,CAACN,MAAM,CAACC,YAAY,CAACI,OAAO,CAAC,OAAO,CAAC,CAAC,CAE9D,GAAG9B,KAAK,EAAImB,IAAI,EAAIC,KAAK,CAAC,CACxBnB,WAAW,CAACD,KAAK,CAAC,CAClBD,UAAU,CAACoB,IAAI,CAAC,CAChBR,eAAe,CAACS,KAAK,CAAC,CACxB,CAEF,CAAC,CAAE,EAAE,CAAC,CAEN,oBACE;AACA,KAAC,SAAS,CAAC,QAAQ,EACjB,KAAK,CAAE,CACLR,iBAAiB,CAAjBA,iBAAiB,CACjBZ,KAAK,CAALA,KAAK,CACLC,WAAW,CAAXA,WAAW,CACXH,IAAI,CAAJA,IAAI,CACJC,UAAU,CAAVA,UAAU,CACVW,QAAQ,CAARA,QAAQ,CACRC,eAAe,CAAfA,eAAe,CACfT,gBAAgB,CAAhBA,gBACF,CAAE,UACDL,KAAK,CAACmC,QAAQ,EACI,EAEzB,CAAC,CAED,cAAepC,QAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}